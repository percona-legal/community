<!doctype html><html lang=en prefix="og: https://ogp.me/ns#"><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,initial-scale=1,minimum-scale=1"><title>IIoT platform databases - How Mail.ru Cloud Solutions deals with petabytes of data coming from a multitude of devices | Percona Community</title><meta name=description content="Hello, my name is Andrey Sergeyev and I work as a Head of IoT Solution Development at Mail.ru Cloud Solutions. We all know there is no such thing as a universal database. Especially when the task is to build an IoT platform that would be capable of processing millions of events from various sensors in near real-time.
Our product Mail.ru IoT Platform started as a Tarantool-based prototype. I‚Äôm going to tell you about our journey, the problems we faced and the solutions we found."><link rel=canonical href=https://percona.community/blog/2020-07-24-iiot-platform-databases-how-mail-ru-cloud-solutions-deals-with-petabytes-of-data-coming-from-a-multitude-of-devices/><meta name=robots content="noindex,nofollow"><meta property="og:title" content="IIoT platform databases - How Mail.ru Cloud Solutions deals with petabytes of data coming from a multitude of devices"><meta property="og:description" content="Hello, my name is Andrey Sergeyev and I work as a Head of IoT Solution Development at Mail.ru Cloud Solutions. We all know there is no such thing as a universal database. Especially when the task is to build an IoT platform that would be capable of processing millions of events from various sensors in near real-time.
Our product Mail.ru IoT Platform started as a Tarantool-based prototype. I‚Äôm going to tell you about our journey, the problems we faced and the solutions we found."><meta property="og:type" content="article"><meta property="og:url" content="https://percona.community/blog/2020-07-24-iiot-platform-databases-how-mail-ru-cloud-solutions-deals-with-petabytes-of-data-coming-from-a-multitude-of-devices/"><meta name=image property="og:image" content="https://percona.community/blog/2020/07/image6_hu9a570a9ab6fb45fd89d79d40033f7e21_278260_1200x0_resize_q90_bgffffff_lanczos_2.jpg"><meta property="article:published_time" content="2020-07-24T14:11:14+00:00"><meta property="article:modified_time" content="2020-07-24T14:11:14+00:00"><meta property="article:section" content="blog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://percona.community/blog/2020/07/image6.png"><meta name=twitter:title content="IIoT platform databases - How Mail.ru Cloud Solutions deals with petabytes of data coming from a multitude of devices | Percona Community"><meta name=twitter:description content="Hello, my name is Andrey Sergeyev and I work as a Head of IoT Solution Development at Mail.ru Cloud Solutions. We all know there is no such thing as a universal database. Especially when the task is to build an IoT platform that would be capable of processing millions of events from various sensors in near real-time.
Our product Mail.ru IoT Platform started as a Tarantool-based prototype. I‚Äôm going to tell you about our journey, the problems we faced and the solutions we found."><meta name=twitter:site content="@Percona"><meta name=description content="Hello, my name is Andrey Sergeyev and I work as a Head of IoT Solution Development at Mail.ru Cloud Solutions. We all know there is no such thing as a universal database. Especially when the task is to build an IoT platform that would be capable of processing millions of events from various sensors in near real-time.
Our product Mail.ru IoT Platform started as a Tarantool-based prototype. I‚Äôm going to tell you about our journey, the problems we faced and the solutions we found."><meta name=copyright content="¬© Percona Community. MySQL, InnoDB, MariaDB and MongoDB are trademarks of their respective owners.
"><meta name=author content="Andrey Sergeev"><style>@charset "UTF-8";html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td,article,aside,canvas,details,embed,figure,figcaption,footer,header,hgroup,menu,nav,output,ruby,section,summary,time,mark,audio,video{margin:0;padding:0;border:0;vertical-align:baseline}article,aside,details,figcaption,figure,footer,header,hgroup,menu,nav,section{display:block}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after{content:none}q:before,q:after{content:none}table{border-collapse:collapse;border-spacing:0}html,body{font-family:Arial,sans-serif;scroll-behavior:smooth;text-rendering:optimizeSpeed;-webkit-font-smoothing:antialiased;line-height:1.5rem;font-feature-settings:"liga" 1;font-weight:500;font-size:18px}@media(min-width:900px){html,body{font-size:20px}}@media(min-width:1100px){html,body{font-size:22px}}@media(min-width:1800px){html,body{font-size:24px}}@media print{html,body{font-size:18px}}hr{border:0;height:2px;background-color:#fe7f2d;margin-top:1.5rem;margin-bottom:1.5rem}.text{position:relative}.text .meta{font-variant:small-caps}.text .meta .byline{display:none}.text .meta .line{display:inline-block}.text .meta .calendar{display:none}.text h1,.text h2,.text h3,.text h4,.text h5,.text h6{font-family:Georgia,palatino linotype,book antiqua,Palatino,times new roman,serif;font-weight:500;page-break-after:avoid}.text h1 a,.text h1 a:visited,.text h2 a,.text h2 a:visited,.text h3 a,.text h3 a:visited,.text h4 a,.text h4 a:visited,.text h5 a,.text h5 a:visited,.text h6 a,.text h6 a:visited{color:#2a2d34;text-decoration:none}.text p,.text ul,.text ol,.text figure,.text dl,.text hr{margin-top:1.5rem;font-size:1rem}.text q{font-style:italic}.text ul ul{margin-top:0}.text p>code,.text ul>code,.text ol>code,.text dt>code,.text dd>code,.text li>code{color:#009b72}.text button{cursor:pointer;display:inline-block;box-sizing:border-box;border:.1rem solid #6761a8;height:1.5rem;padding-left:.75rem;padding-right:.75rem;border-radius:.2rem;transition:color .233s ease-in-out,background-color .233s ease-in-out}.text button:hover{color:#fff;background-color:#6761a8}.text audio{display:block;width:100%;height:1.5rem;outline:none}.text audio span{line-height:1.5rem}.text dl{overflow:auto;position:relative}.text dt{font-weight:700}.text dd{padding-left:2rem}.text dd+dt{margin-top:1.5rem}.text ul{list-style-type:disc;padding-left:1.5rem}.text ol{list-style-type:decimal;padding-left:1.5rem}.text p{overflow-wrap:break-word;word-wrap:break-word;-webkit-hyphens:auto;-moz-hyphens:auto;-ms-hyphens:auto;hyphens:auto}.text h1{font-size:2.5rem;font-weight:500;line-height:3rem;margin-top:1.5rem;margin-bottom:0}@media screen and (min-width:760px){.text h1{font-size:3.5rem;line-height:4.5rem;margin-top:1.5rem}}@media screen and (min-width:900px){.text h1{font-size:4rem;line-height:4.5rem;margin-top:3rem}}@media screen and (min-width:1400px){.text h1{font-size:5rem;line-height:6rem;margin-top:6rem}}.text h2{font-size:2rem;line-height:3rem;margin-top:3rem;margin-bottom:3rem}.text h3{font-size:1.5rem;line-height:1.5rem;margin-top:1.5rem;margin-bottom:1.5rem}.text h4{font-size:1rem;line-height:1.5rem;margin-top:1.5rem;margin-bottom:1.5rem}.text h5{font-size:.8rem;line-height:1.5rem;margin-top:1.5rem;margin-bottom:1.5rem}.text h6{font-size:.6rem;line-height:1.5rem;margin-top:1.5rem;margin-bottom:1.5rem}.text strong{font-weight:700}.text em{font-style:italic}.text blockquote{border-left:.2rem solid #999;padding-left:.75rem}.text code{font-family:lucida console,Monaco,monospace;speak:literal-punctuation}.text abbr,.text acronym{speak:spell-out}.text del{text-decoration:line-through}.text ins{text-decoration:none;font-style:italic}.text figure{position:relative;text-align:center}.text figure img{background:#fff;border-radius:.2rem;max-width:100%}.text figure table{min-width:75%;border-radius:.2rem;margin-left:auto;margin-right:auto;border:#6761a8;border-collapse:separate;border-spacing:0;background:#fff;margin-bottom:-.1em}.text figure table th,.text figure table td{padding-left:.75rem;padding-right:.75rem;line-height:1.3rem;border-left:.1rem solid #6761a8;border-top:.1rem solid #6761a8}.text figure table thead{background-color:#fff}.text figure table tr td:last-child,.text figure table tr th:last-child{border-right:.1rem solid #6761a8}.text figure table tbody:last-child tr:last-child td{border-bottom:.1rem solid #6761a8}.text figure table thead:first-child tr:first-child th:first-child,.text figure table thead:first-child tr:first-child td:first-child{border-top-left-radius:.2rem}.text figure table thead:first-child tr:first-child,.text figure table thead:first-child tr:first-child th:last-child,.text figure table thead:first-child tr:first-child td:last-child{border-top-right-radius:.2rem}.text figure table tbody:last-child tr:last-child,.text figure table tbody:last-child tr:last-child td:first-child{border-bottom-left-radius:.2rem}.text figure table tbody:last-child tr:last-child,.text figure table tbody:last-child tr:last-child td:last-child{border-bottom-right-radius:.2rem}.text figure ul{text-align:left}.text figure ul.tree{padding-top:1.5em;padding-bottom:1.5em;border-radius:.2rem;background:#fff}.text figure ul.tree li{list-style-type:none}.text figure ul.tree .tree__item--folder::before{content:"üìÅ";margin-right:.2em}.text figure ul.tree .tree__item--file::before{content:"üìù";margin-right:.2em}.text figure figcaption{font-style:italic}.text pre{margin-top:1.5rem;font-size:inherit;line-height:1.5rem;padding:1.5rem 1.5rem .75rem;white-space:pre;overflow-x:scroll;overflow-y:hidden;scrollbar-color:#cccccc transparent;scrollbar-width:.75rem}.text pre::-webkit-scrollbar{margin-top:-.75rem;height:.75rem}.text pre::-webkit-scrollbar-track{background:0 0}.text pre::-webkit-scrollbar-thumb{height:.1rem;border-radius:.2rem;background:#ccc}.text hr{border:0;height:.2rem;background:#6761a8;margin-top:1.3rem}.text .admonition{position:relative}.text .admonition>*{padding-left:2rem}.text .admonition>:first-child::before{display:block;text-align:left;position:absolute;top:0;left:0;width:.75rem;font-size:1rem;line-height:1.5rem;height:1.5rem}.text .admonition--tip>:first-child::before{content:"‚òõ";color:#00a000;font-size:1.5rem;line-height:1.5rem;height:1.5rem}.text .admonition--warning>:first-child::before{content:"‚ö†Ô∏è";color:#fe7f2d}.text .admonition--info>:first-child::before{content:"‚ìò";color:#004966;font-weight:700}@media print{.text h1{margin-left:auto;margin-right:auto;margin-top:9rem;width:80%;font-variant:small-caps;text-align:center}.text--simple h1{margin-top:0}.text .meta{page-break-after:always;text-align:center;font-size:1.2rem;margin-top:1.5rem}.text .meta a{text-decoration:none}.text .meta time{display:none}.text .body p:first-of-type{margin-top:0}.text pre{padding:0;font-size:inherit;line-height:1.5rem;overflow:hidden;white-space:pre-wrap;word-break:break-all}}.text .podcasts{margin-top:1.5rem;text-align:center}.text a.podcast{display:block;height:3rem}.text a.podcast img{width:50%;max-width:200px}@media screen and (min-width:768px){.text .podcasts{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));grid-gap:1.5rem}.text a.podcast img{width:100%}}.text .tombstone{opacity:0}html,body{min-height:100vh}body{text-align:center}@media screen{body{color:#2a2d34;background-color:#fefefe}}@media print{body{color:#000;background:#fff}}@media screen{body{display:flex;flex-direction:column}main.page{width:100%;flex:1}}header.page,main.page,footer.page{text-align:left}.page-main,.contentblock{max-width:1400px;padding-left:1.5rem;padding-right:1.5rem;margin-left:auto;margin-right:auto}@media print{.page-main,.contentblock{padding:0}}@page{size:A4;padding:0;margin:3rem}.highlight{color:#6761a8}.nobr{white-space:nowrap}.aria-only{display:none}@media aural{.aria-only{display:block}}a{color:#004966;text-decoration-color:#a2dffb;transition:color .233s ease-out,text-decoration-color .233s ease-out}a:hover,a:visited:hover{color:#fe7f2d}a:active{color:#fe7f2d}a:visited{color:#6761a8;text-decoration-color:#009b72}html,body{font-family:Arial,sans-serif;scroll-behavior:smooth;text-rendering:optimizeSpeed;-webkit-font-smoothing:antialiased;line-height:1.5rem;font-feature-settings:"liga" 1;font-weight:500;font-size:18px}@media(min-width:900px){html,body{font-size:20px}}@media(min-width:1100px){html,body{font-size:22px}}@media(min-width:1800px){html,body{font-size:24px}}@media print{html,body{font-size:18px}}hr{border:0;height:2px;background-color:#fe7f2d;margin-top:1.5rem;margin-bottom:1.5rem}.text{position:relative}.text .meta{font-variant:small-caps}.text .meta .byline{display:none}.text .meta .line{display:inline-block}.text .meta .calendar{display:none}.text h1,.text h2,.text h3,.text h4,.text h5,.text h6{font-family:Georgia,palatino linotype,book antiqua,Palatino,times new roman,serif;font-weight:500;page-break-after:avoid}.text h1 a,.text h1 a:visited,.text h2 a,.text h2 a:visited,.text h3 a,.text h3 a:visited,.text h4 a,.text h4 a:visited,.text h5 a,.text h5 a:visited,.text h6 a,.text h6 a:visited{color:#2a2d34;text-decoration:none}.text p,.text ul,.text ol,.text figure,.text dl,.text hr{margin-top:1.5rem;font-size:1rem}.text q{font-style:italic}.text ul ul{margin-top:0}.text p>code,.text ul>code,.text ol>code,.text dt>code,.text dd>code,.text li>code{color:#009b72}.text button{cursor:pointer;display:inline-block;box-sizing:border-box;border:.1rem solid #6761a8;height:1.5rem;padding-left:.75rem;padding-right:.75rem;border-radius:.2rem;transition:color .233s ease-in-out,background-color .233s ease-in-out}.text button:hover{color:#fff;background-color:#6761a8}.text audio{display:block;width:100%;height:1.5rem;outline:none}.text audio span{line-height:1.5rem}.text dl{overflow:auto;position:relative}.text dt{font-weight:700}.text dd{padding-left:2rem}.text dd+dt{margin-top:1.5rem}.text ul{list-style-type:disc;padding-left:1.5rem}.text ol{list-style-type:decimal;padding-left:1.5rem}.text p{overflow-wrap:break-word;word-wrap:break-word;-webkit-hyphens:auto;-moz-hyphens:auto;-ms-hyphens:auto;hyphens:auto}.text h1{font-size:2.5rem;font-weight:500;line-height:3rem;margin-top:1.5rem;margin-bottom:0}@media screen and (min-width:760px){.text h1{font-size:3.5rem;line-height:4.5rem;margin-top:1.5rem}}@media screen and (min-width:900px){.text h1{font-size:4rem;line-height:4.5rem;margin-top:3rem}}@media screen and (min-width:1400px){.text h1{font-size:5rem;line-height:6rem;margin-top:6rem}}.text h2{font-size:2rem;line-height:3rem;margin-top:3rem;margin-bottom:3rem}.text h3{font-size:1.5rem;line-height:1.5rem;margin-top:1.5rem;margin-bottom:1.5rem}.text h4{font-size:1rem;line-height:1.5rem;margin-top:1.5rem;margin-bottom:1.5rem}.text h5{font-size:.8rem;line-height:1.5rem;margin-top:1.5rem;margin-bottom:1.5rem}.text h6{font-size:.6rem;line-height:1.5rem;margin-top:1.5rem;margin-bottom:1.5rem}.text strong{font-weight:700}.text em{font-style:italic}.text blockquote{border-left:.2rem solid #999;padding-left:.75rem}.text code{font-family:lucida console,Monaco,monospace;speak:literal-punctuation}.text abbr,.text acronym{speak:spell-out}.text del{text-decoration:line-through}.text ins{text-decoration:none;font-style:italic}.text figure{position:relative;text-align:center}.text figure img{background:#fff;border-radius:.2rem;max-width:100%}.text figure table{min-width:75%;border-radius:.2rem;margin-left:auto;margin-right:auto;border:#6761a8;border-collapse:separate;border-spacing:0;background:#fff;margin-bottom:-.1em}.text figure table th,.text figure table td{padding-left:.75rem;padding-right:.75rem;line-height:1.3rem;border-left:.1rem solid #6761a8;border-top:.1rem solid #6761a8}.text figure table thead{background-color:#fff}.text figure table tr td:last-child,.text figure table tr th:last-child{border-right:.1rem solid #6761a8}.text figure table tbody:last-child tr:last-child td{border-bottom:.1rem solid #6761a8}.text figure table thead:first-child tr:first-child th:first-child,.text figure table thead:first-child tr:first-child td:first-child{border-top-left-radius:.2rem}.text figure table thead:first-child tr:first-child,.text figure table thead:first-child tr:first-child th:last-child,.text figure table thead:first-child tr:first-child td:last-child{border-top-right-radius:.2rem}.text figure table tbody:last-child tr:last-child,.text figure table tbody:last-child tr:last-child td:first-child{border-bottom-left-radius:.2rem}.text figure table tbody:last-child tr:last-child,.text figure table tbody:last-child tr:last-child td:last-child{border-bottom-right-radius:.2rem}.text figure ul{text-align:left}.text figure ul.tree{padding-top:1.5em;padding-bottom:1.5em;border-radius:.2rem;background:#fff}.text figure ul.tree li{list-style-type:none}.text figure ul.tree .tree__item--folder::before{content:"üìÅ";margin-right:.2em}.text figure ul.tree .tree__item--file::before{content:"üìù";margin-right:.2em}.text figure figcaption{font-style:italic}.text pre{margin-top:1.5rem;font-size:inherit;line-height:1.5rem;padding:1.5rem 1.5rem .75rem;white-space:pre;overflow-x:scroll;overflow-y:hidden;scrollbar-color:#cccccc transparent;scrollbar-width:.75rem}.text pre::-webkit-scrollbar{margin-top:-.75rem;height:.75rem}.text pre::-webkit-scrollbar-track{background:0 0}.text pre::-webkit-scrollbar-thumb{height:.1rem;border-radius:.2rem;background:#ccc}.text hr{border:0;height:.2rem;background:#6761a8;margin-top:1.3rem}.text .admonition{position:relative}.text .admonition>*{padding-left:2rem}.text .admonition>:first-child::before{display:block;text-align:left;position:absolute;top:0;left:0;width:.75rem;font-size:1rem;line-height:1.5rem;height:1.5rem}.text .admonition--tip>:first-child::before{content:"‚òõ";color:#00a000;font-size:1.5rem;line-height:1.5rem;height:1.5rem}.text .admonition--warning>:first-child::before{content:"‚ö†Ô∏è";color:#fe7f2d}.text .admonition--info>:first-child::before{content:"‚ìò";color:#004966;font-weight:700}@media print{.text h1{margin-left:auto;margin-right:auto;margin-top:9rem;width:80%;font-variant:small-caps;text-align:center}.text--simple h1{margin-top:0}.text .meta{page-break-after:always;text-align:center;font-size:1.2rem;margin-top:1.5rem}.text .meta a{text-decoration:none}.text .meta time{display:none}.text .body p:first-of-type{margin-top:0}.text pre{padding:0;font-size:inherit;line-height:1.5rem;overflow:hidden;white-space:pre-wrap;word-break:break-all}}.text .podcasts{margin-top:1.5rem;text-align:center}.text a.podcast{display:block;height:3rem}.text a.podcast img{width:50%;max-width:200px}@media screen and (min-width:768px){.text .podcasts{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));grid-gap:1.5rem}.text a.podcast img{width:100%}}.text .tombstone{opacity:0}.page-header a{display:block;text-decoration:none;height:2.6rem;line-height:2.6rem;border-top:.2rem solid transparent;border-bottom:.2rem solid transparent}.page-header a,.page-header a span{transition:color .233s ease-in-out,border-bottom .233s,margin-bottom .233s}.page-header a:hover{color:#004966;border-bottom:.2rem solid #004966}.page-header a:hover span{color:#004966}.page-header a img{height:2.6rem}.page-header a{color:#2a2d34;border-bottom:0 solid #fefefe}.page-header a:hover{color:#004966;border-bottom-color:#004966}.page-header a:visited{color:#2a2d34}.page-header a{display:block;border-bottom-width:0;font-weight:700}.page-header .logo{z-index:6;font-size:1.2rem;font-weight:700;font-variant:small-caps}.page-header .logo a{margin-top:.2rem;text-decoration:none;display:block;border:none}#show-mobile-menu{display:none}.mobile-toggle{display:none}@media screen and (max-width:759px){header.page{box-shadow:0 0 3px rgba(168,168,168,.5)}.logo a{position:absolute}.page-header{justify-content:space-between;z-index:1}.hamburger-bar{height:.2rem;background:#2a2d34;margin-top:.2rem;display:block}#show-mobile-menu+.mobile-toggle+.mobile-menu nav{background:#fefefe}#show-mobile-menu+.mobile-toggle .hamburger-bar{transform:translateY(0)rotate(0);opacity:1;transition:transform .233s ease-in-out,opacity .233s ease-in-out}#show-mobile-menu:checked+.mobile-toggle{position:fixed;right:1.5rem}#show-mobile-menu:checked+.mobile-toggle .hamburger-bar:nth-of-type(1){transform:translateY(.4rem)rotate(315deg)}#show-mobile-menu:checked+.mobile-toggle .hamburger-bar:nth-of-type(2){opacity:0}#show-mobile-menu:checked+.mobile-toggle .hamburger-bar:nth-of-type(3){transform:translateY(-.4rem)rotate(405deg)}.mobile-toggle{cursor:pointer;display:block;width:1.2rem;height:1rem;z-index:5;margin-top:.75rem}.mobile-toggle label,.mobile-toggle .hamburger-bar{cursor:pointer}.mobile-menu{overflow:hidden;position:fixed;top:0;left:0;right:0;bottom:100vh;opacity:0;background:rgba(0,0,0,.5);transition:opacity .233s ease-in-out,bottom .233s ease-in-out}#show-mobile-menu:checked+.mobile-toggle+.mobile-menu{opacity:1;bottom:0}.hide-mobile-menu{display:block;position:absolute;top:0;left:0;right:0;bottom:0;z-index:2}.mobile-menu nav{box-sizing:border-box;max-height:100%;position:absolute;top:0;left:0;right:0;z-index:3;font-size:1rem;line-height:3rem;padding:3rem 1.5rem 1.5rem;display:flex;flex-direction:column}.mobile-menu nav header{display:flex;flex-direction:row;font-size:inherit;line-height:inherit}.mobile-menu nav header h1{margin-top:0;font-size:1.2rem;line-height:1.5rem;flex:1;font-variant:small-caps}.mobile-menu nav header .hide-mobile-menu-aria{display:block;z-index:10;height:1.5rem;width:1.5rem}.mobile-menu nav ul{overflow-y:scroll;flex:1;scrollbar-width:none;-ms-overflow-style:none}.mobile-menu nav ul::-webkit-scrollbar{width:0;background:0 0}.mobile-menu nav a:hover{border-bottom:0;margin-bottom:0}}@media screen and (min-width:760px){.page-header .mobile-toggle{display:none}.page-header .mobile-menu{flex:1}.page-header nav{flex:1}.page-header nav header{display:none}.page-header ul{list-style-type:none}.page-header nav ul{display:flex;align-items:end;justify-content:flex-end;flex-direction:row}.page-header nav li{padding-left:1.5rem}.page-header nav li.active a{border-bottom-width:3px;border-bottom-color:#6761a8}}@media screen{.page-header{position:relative;max-width:1400px;margin-left:auto;margin-right:auto;padding-left:1.5rem;padding-right:1.5rem;height:3rem;display:flex;flex-direction:row}}@media print{header.page{display:none}}@media screen and (max-width:759px) and (prefers-reduced-motion:reduce){.mobile-menu{transition:none}#show-mobile-menu+.mobile-toggle .hamburger-bar{transition:none}}@media screen and (max-width:759px) and (prefers-reduced-transparency:reduce){.mobile-menu{background:gray}}html,body{font-family:Arial,sans-serif;scroll-behavior:smooth;text-rendering:optimizeSpeed;-webkit-font-smoothing:antialiased;line-height:1.5rem;font-feature-settings:"liga" 1;font-weight:500;font-size:18px}@media(min-width:900px){html,body{font-size:20px}}@media(min-width:1100px){html,body{font-size:22px}}@media(min-width:1800px){html,body{font-size:24px}}@media print{html,body{font-size:18px}}hr{border:0;height:2px;background-color:#fe7f2d;margin-top:1.5rem;margin-bottom:1.5rem}.text{position:relative}.text .meta{font-variant:small-caps}.text .meta .byline{display:none}.text .meta .line{display:inline-block}.text .meta .calendar{display:none}.text h1,.text h2,.text h3,.text h4,.text h5,.text h6{font-family:Georgia,palatino linotype,book antiqua,Palatino,times new roman,serif;font-weight:500;page-break-after:avoid}.text h1 a,.text h1 a:visited,.text h2 a,.text h2 a:visited,.text h3 a,.text h3 a:visited,.text h4 a,.text h4 a:visited,.text h5 a,.text h5 a:visited,.text h6 a,.text h6 a:visited{color:#2a2d34;text-decoration:none}.text p,.text ul,.text ol,.text figure,.text dl,.text hr{margin-top:1.5rem;font-size:1rem}.text q{font-style:italic}.text ul ul{margin-top:0}.text p>code,.text ul>code,.text ol>code,.text dt>code,.text dd>code,.text li>code{color:#009b72}.text button{cursor:pointer;display:inline-block;box-sizing:border-box;border:.1rem solid #6761a8;height:1.5rem;padding-left:.75rem;padding-right:.75rem;border-radius:.2rem;transition:color .233s ease-in-out,background-color .233s ease-in-out}.text button:hover{color:#fff;background-color:#6761a8}.text audio{display:block;width:100%;height:1.5rem;outline:none}.text audio span{line-height:1.5rem}.text dl{overflow:auto;position:relative}.text dt{font-weight:700}.text dd{padding-left:2rem}.text dd+dt{margin-top:1.5rem}.text ul{list-style-type:disc;padding-left:1.5rem}.text ol{list-style-type:decimal;padding-left:1.5rem}.text p{overflow-wrap:break-word;word-wrap:break-word;-webkit-hyphens:auto;-moz-hyphens:auto;-ms-hyphens:auto;hyphens:auto}.text h1{font-size:2.5rem;font-weight:500;line-height:3rem;margin-top:1.5rem;margin-bottom:0}@media screen and (min-width:760px){.text h1{font-size:3.5rem;line-height:4.5rem;margin-top:1.5rem}}@media screen and (min-width:900px){.text h1{font-size:4rem;line-height:4.5rem;margin-top:3rem}}@media screen and (min-width:1400px){.text h1{font-size:5rem;line-height:6rem;margin-top:6rem}}.text h2{font-size:2rem;line-height:3rem;margin-top:3rem;margin-bottom:3rem}.text h3{font-size:1.5rem;line-height:1.5rem;margin-top:1.5rem;margin-bottom:1.5rem}.text h4{font-size:1rem;line-height:1.5rem;margin-top:1.5rem;margin-bottom:1.5rem}.text h5{font-size:.8rem;line-height:1.5rem;margin-top:1.5rem;margin-bottom:1.5rem}.text h6{font-size:.6rem;line-height:1.5rem;margin-top:1.5rem;margin-bottom:1.5rem}.text strong{font-weight:700}.text em{font-style:italic}.text blockquote{border-left:.2rem solid #999;padding-left:.75rem}.text code{font-family:lucida console,Monaco,monospace;speak:literal-punctuation}.text abbr,.text acronym{speak:spell-out}.text del{text-decoration:line-through}.text ins{text-decoration:none;font-style:italic}.text figure{position:relative;text-align:center}.text figure img{background:#fff;border-radius:.2rem;max-width:100%}.text figure table{min-width:75%;border-radius:.2rem;margin-left:auto;margin-right:auto;border:#6761a8;border-collapse:separate;border-spacing:0;background:#fff;margin-bottom:-.1em}.text figure table th,.text figure table td{padding-left:.75rem;padding-right:.75rem;line-height:1.3rem;border-left:.1rem solid #6761a8;border-top:.1rem solid #6761a8}.text figure table thead{background-color:#fff}.text figure table tr td:last-child,.text figure table tr th:last-child{border-right:.1rem solid #6761a8}.text figure table tbody:last-child tr:last-child td{border-bottom:.1rem solid #6761a8}.text figure table thead:first-child tr:first-child th:first-child,.text figure table thead:first-child tr:first-child td:first-child{border-top-left-radius:.2rem}.text figure table thead:first-child tr:first-child,.text figure table thead:first-child tr:first-child th:last-child,.text figure table thead:first-child tr:first-child td:last-child{border-top-right-radius:.2rem}.text figure table tbody:last-child tr:last-child,.text figure table tbody:last-child tr:last-child td:first-child{border-bottom-left-radius:.2rem}.text figure table tbody:last-child tr:last-child,.text figure table tbody:last-child tr:last-child td:last-child{border-bottom-right-radius:.2rem}.text figure ul{text-align:left}.text figure ul.tree{padding-top:1.5em;padding-bottom:1.5em;border-radius:.2rem;background:#fff}.text figure ul.tree li{list-style-type:none}.text figure ul.tree .tree__item--folder::before{content:"üìÅ";margin-right:.2em}.text figure ul.tree .tree__item--file::before{content:"üìù";margin-right:.2em}.text figure figcaption{font-style:italic}.text pre{margin-top:1.5rem;font-size:inherit;line-height:1.5rem;padding:1.5rem 1.5rem .75rem;white-space:pre;overflow-x:scroll;overflow-y:hidden;scrollbar-color:#cccccc transparent;scrollbar-width:.75rem}.text pre::-webkit-scrollbar{margin-top:-.75rem;height:.75rem}.text pre::-webkit-scrollbar-track{background:0 0}.text pre::-webkit-scrollbar-thumb{height:.1rem;border-radius:.2rem;background:#ccc}.text hr{border:0;height:.2rem;background:#6761a8;margin-top:1.3rem}.text .admonition{position:relative}.text .admonition>*{padding-left:2rem}.text .admonition>:first-child::before{display:block;text-align:left;position:absolute;top:0;left:0;width:.75rem;font-size:1rem;line-height:1.5rem;height:1.5rem}.text .admonition--tip>:first-child::before{content:"‚òõ";color:#00a000;font-size:1.5rem;line-height:1.5rem;height:1.5rem}.text .admonition--warning>:first-child::before{content:"‚ö†Ô∏è";color:#fe7f2d}.text .admonition--info>:first-child::before{content:"‚ìò";color:#004966;font-weight:700}@media print{.text h1{margin-left:auto;margin-right:auto;margin-top:9rem;width:80%;font-variant:small-caps;text-align:center}.text--simple h1{margin-top:0}.text .meta{page-break-after:always;text-align:center;font-size:1.2rem;margin-top:1.5rem}.text .meta a{text-decoration:none}.text .meta time{display:none}.text .body p:first-of-type{margin-top:0}.text pre{padding:0;font-size:inherit;line-height:1.5rem;overflow:hidden;white-space:pre-wrap;word-break:break-all}}.text .podcasts{margin-top:1.5rem;text-align:center}.text a.podcast{display:block;height:3rem}.text a.podcast img{width:50%;max-width:200px}@media screen and (min-width:768px){.text .podcasts{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));grid-gap:1.5rem}.text a.podcast img{width:100%}}.text .tombstone{opacity:0}html,body{min-height:100vh}body{text-align:center}@media screen{body{color:#2a2d34;background-color:#fefefe}}@media print{body{color:#000;background:#fff}}@media screen{body{display:flex;flex-direction:column}main.page{width:100%;flex:1}}header.page,main.page,footer.page{text-align:left}.page-main,.contentblock{max-width:1400px;padding-left:1.5rem;padding-right:1.5rem;margin-left:auto;margin-right:auto}@media print{.page-main,.contentblock{padding:0}}@page{size:A4;padding:0;margin:3rem}.highlight{color:#6761a8}.nobr{white-space:nowrap}.aria-only{display:none}@media aural{.aria-only{display:block}}a{color:#004966;text-decoration-color:#a2dffb;transition:color .233s ease-out,text-decoration-color .233s ease-out}a:hover,a:visited:hover{color:#fe7f2d}a:active{color:#fe7f2d}a:visited{color:#6761a8;text-decoration-color:#009b72}footer.page{margin-top:1.5rem}footer.page h2{font-size:1rem}@media not print{footer.page{margin-top:1.5rem/2;padding-top:1.5rem/2;padding-bottom:1.5rem/2}.page-footer{max-width:1400px;padding-left:1.5rem;padding-right:1.5rem;margin-left:auto;margin-right:auto;font-size:.7rem;line-height:1.5rem}}@media not print{.page-footer ul{margin-bottom:1.5rem}.page-footer a{display:block;text-decoration:none;height:2.6rem;line-height:2.6rem;border-top:.2rem solid transparent;border-bottom:.2rem solid transparent}.page-footer a,.page-footer a span{transition:color .233s ease-in-out,border-bottom .233s,margin-bottom .233s}.page-footer a:hover{color:#004966;border-bottom:.2rem solid #004966}.page-footer a:hover span{color:#004966}.page-footer a img{height:2.6rem}.page-footer nav ul{display:flex;flex-direction:row;align-items:center;justify-content:center;margin-bottom:0;height:1.5rem;line-height:1.5rem}.page-footer nav ul a{height:1.3rem;line-height:1.3rem;text-align:center;display:block;padding-left:.75rem;padding-right:.75rem;border-bottom:.2rem solid transparent}}@media print{footer.page nav{display:none}footer.page aside{border-top:.2rem solid #333;margin-top:.65rem;padding-top:.65rem}}footer.page{border-top:2px solid #fe7f2d;margin-top:-2px}footer.page aside{text-align:center;font-size:.6rem;line-height:1.5rem;color:#333}@media screen{footer.page{background-color:#fefefe}.page-footer a{color:#2a2d34;border-bottom:0 solid #fefefe}.page-footer a:hover{color:#004966;border-bottom-color:#004966}.page-footer a:visited{color:#2a2d34}}.grid{display:grid;gap:1.5rem 1.5rem;font-size:.9rem;margin-bottom:1.5rem;margin-top:1.5rem}.grid--2{grid-template-columns:1fr 1fr}.grid--3{grid-template-columns:1fr 1fr 1fr}.grid--4{grid-template-columns:1fr 1fr 1fr}.grid img{max-width:100%}.grid h2{font-size:1.2rem;margin-bottom:.75rem}.grid p{margin-bottom:.75rem}@media(max-width:768px){.grid--2{display:block}}@media(max-width:1200px){.grid--3{display:block}}@media(max-width:1600px){.grid--4{display:block}}.post--preview{display:block;border-radius:.3rem;padding-bottom:.375rem}.post--preview img{margin-bottom:.375rem}.post--preview h2,.post--preview p{padding-left:.5rem;padding-right:.5rem}.post--preview :last-child{margin-bottom:0}.post--preview:hover{box-shadow:0 0 1.5rem #666666}a.post--preview,a.post--preview *{text-decoration:none;color:#2a2d34}a.post--preview .readmore,a.post--preview * .readmore{font-weight:700}.hero{background-color:#004966;background-position:50%;background-repeat:no-repeat;background-size:cover;color:#fff}.hero h1{margin-bottom:1.5rem}.hero a{color:#fff;font-weight:700;border-bottom:2px solid #fff;text-decoration:none;transition:color .233s ease-out,border-bottom-color .233s ease-out}.hero a:hover,.hero a:visited:hover{color:#fff;border-bottom-color:#fe7f2d}.hero img{float:left;margin-right:1.5rem}.hero:nth-child(4n+2),.hero:nth-child(4n+4){background-color:initial;color:#2a2d34}.hero:nth-child(4n+2) img,.hero:nth-child(4n+4) img{float:right;margin-right:0;margin-left:1.5rem}.hero:nth-child(4n+2) a,.hero:nth-child(4n+4) a{color:#2a2d34}.hero:nth-child(4n+2) a:hover,.hero:nth-child(4n+4) a:hover{color:#2a2d34}.hero:nth-child(4n+3){background-color:#fe7f2d}.hero--bio .contentblock{text-align:center}.hero--bio .contentblock img{text-align:center;float:none;margin-bottom:1.5rem}.hero--bio .contentblock p{text-align:left}@media(min-width:769px){.hero--bio .contentblock{min-height:240px;text-align:left}.hero--bio .contentblock img{float:right;margin-left:1.5rem;margin-bottom:0}}.contentblock{padding-top:3rem;padding-bottom:3rem}.herotext{font-size:1.2rem;background:rgba(0,0,0,.5);padding:1.5rem;border-radius:.75rem}.herotext p{margin-top:1.5rem}.herotext p:first-child{margin-top:0}.herotext small{font-size:.8rem}html,body{font-family:Arial,sans-serif;scroll-behavior:smooth;text-rendering:optimizeSpeed;-webkit-font-smoothing:antialiased;line-height:1.5rem;font-feature-settings:"liga" 1;font-weight:500;font-size:18px}@media(min-width:900px){html,body{font-size:20px}}@media(min-width:1100px){html,body{font-size:22px}}@media(min-width:1800px){html,body{font-size:24px}}@media print{html,body{font-size:18px}}hr{border:0;height:2px;background-color:#fe7f2d;margin-top:1.5rem;margin-bottom:1.5rem}.text{position:relative}.text .meta{font-variant:small-caps}.text .meta .byline{display:none}.text .meta .line{display:inline-block}.text .meta .calendar{display:none}.text h1,.text h2,.text h3,.text h4,.text h5,.text h6{font-family:Georgia,palatino linotype,book antiqua,Palatino,times new roman,serif;font-weight:500;page-break-after:avoid}.text h1 a,.text h1 a:visited,.text h2 a,.text h2 a:visited,.text h3 a,.text h3 a:visited,.text h4 a,.text h4 a:visited,.text h5 a,.text h5 a:visited,.text h6 a,.text h6 a:visited{color:#2a2d34;text-decoration:none}.text p,.text ul,.text ol,.text figure,.text dl,.text hr{margin-top:1.5rem;font-size:1rem}.text q{font-style:italic}.text ul ul{margin-top:0}.text p>code,.text ul>code,.text ol>code,.text dt>code,.text dd>code,.text li>code{color:#009b72}.text button{cursor:pointer;display:inline-block;box-sizing:border-box;border:.1rem solid #6761a8;height:1.5rem;padding-left:.75rem;padding-right:.75rem;border-radius:.2rem;transition:color .233s ease-in-out,background-color .233s ease-in-out}.text button:hover{color:#fff;background-color:#6761a8}.text audio{display:block;width:100%;height:1.5rem;outline:none}.text audio span{line-height:1.5rem}.text dl{overflow:auto;position:relative}.text dt{font-weight:700}.text dd{padding-left:2rem}.text dd+dt{margin-top:1.5rem}.text ul{list-style-type:disc;padding-left:1.5rem}.text ol{list-style-type:decimal;padding-left:1.5rem}.text p{overflow-wrap:break-word;word-wrap:break-word;-webkit-hyphens:auto;-moz-hyphens:auto;-ms-hyphens:auto;hyphens:auto}.text h1{font-size:2.5rem;font-weight:500;line-height:3rem;margin-top:1.5rem;margin-bottom:0}@media screen and (min-width:760px){.text h1{font-size:3.5rem;line-height:4.5rem;margin-top:1.5rem}}@media screen and (min-width:900px){.text h1{font-size:4rem;line-height:4.5rem;margin-top:3rem}}@media screen and (min-width:1400px){.text h1{font-size:5rem;line-height:6rem;margin-top:6rem}}.text h2{font-size:2rem;line-height:3rem;margin-top:3rem;margin-bottom:3rem}.text h3{font-size:1.5rem;line-height:1.5rem;margin-top:1.5rem;margin-bottom:1.5rem}.text h4{font-size:1rem;line-height:1.5rem;margin-top:1.5rem;margin-bottom:1.5rem}.text h5{font-size:.8rem;line-height:1.5rem;margin-top:1.5rem;margin-bottom:1.5rem}.text h6{font-size:.6rem;line-height:1.5rem;margin-top:1.5rem;margin-bottom:1.5rem}.text strong{font-weight:700}.text em{font-style:italic}.text blockquote{border-left:.2rem solid #999;padding-left:.75rem}.text code{font-family:lucida console,Monaco,monospace;speak:literal-punctuation}.text abbr,.text acronym{speak:spell-out}.text del{text-decoration:line-through}.text ins{text-decoration:none;font-style:italic}.text figure{position:relative;text-align:center}.text figure img{background:#fff;border-radius:.2rem;max-width:100%}.text figure table{min-width:75%;border-radius:.2rem;margin-left:auto;margin-right:auto;border:#6761a8;border-collapse:separate;border-spacing:0;background:#fff;margin-bottom:-.1em}.text figure table th,.text figure table td{padding-left:.75rem;padding-right:.75rem;line-height:1.3rem;border-left:.1rem solid #6761a8;border-top:.1rem solid #6761a8}.text figure table thead{background-color:#fff}.text figure table tr td:last-child,.text figure table tr th:last-child{border-right:.1rem solid #6761a8}.text figure table tbody:last-child tr:last-child td{border-bottom:.1rem solid #6761a8}.text figure table thead:first-child tr:first-child th:first-child,.text figure table thead:first-child tr:first-child td:first-child{border-top-left-radius:.2rem}.text figure table thead:first-child tr:first-child,.text figure table thead:first-child tr:first-child th:last-child,.text figure table thead:first-child tr:first-child td:last-child{border-top-right-radius:.2rem}.text figure table tbody:last-child tr:last-child,.text figure table tbody:last-child tr:last-child td:first-child{border-bottom-left-radius:.2rem}.text figure table tbody:last-child tr:last-child,.text figure table tbody:last-child tr:last-child td:last-child{border-bottom-right-radius:.2rem}.text figure ul{text-align:left}.text figure ul.tree{padding-top:1.5em;padding-bottom:1.5em;border-radius:.2rem;background:#fff}.text figure ul.tree li{list-style-type:none}.text figure ul.tree .tree__item--folder::before{content:"üìÅ";margin-right:.2em}.text figure ul.tree .tree__item--file::before{content:"üìù";margin-right:.2em}.text figure figcaption{font-style:italic}.text pre{margin-top:1.5rem;font-size:inherit;line-height:1.5rem;padding:1.5rem 1.5rem .75rem;white-space:pre;overflow-x:scroll;overflow-y:hidden;scrollbar-color:#cccccc transparent;scrollbar-width:.75rem}.text pre::-webkit-scrollbar{margin-top:-.75rem;height:.75rem}.text pre::-webkit-scrollbar-track{background:0 0}.text pre::-webkit-scrollbar-thumb{height:.1rem;border-radius:.2rem;background:#ccc}.text hr{border:0;height:.2rem;background:#6761a8;margin-top:1.3rem}.text .admonition{position:relative}.text .admonition>*{padding-left:2rem}.text .admonition>:first-child::before{display:block;text-align:left;position:absolute;top:0;left:0;width:.75rem;font-size:1rem;line-height:1.5rem;height:1.5rem}.text .admonition--tip>:first-child::before{content:"‚òõ";color:#00a000;font-size:1.5rem;line-height:1.5rem;height:1.5rem}.text .admonition--warning>:first-child::before{content:"‚ö†Ô∏è";color:#fe7f2d}.text .admonition--info>:first-child::before{content:"‚ìò";color:#004966;font-weight:700}@media print{.text h1{margin-left:auto;margin-right:auto;margin-top:9rem;width:80%;font-variant:small-caps;text-align:center}.text--simple h1{margin-top:0}.text .meta{page-break-after:always;text-align:center;font-size:1.2rem;margin-top:1.5rem}.text .meta a{text-decoration:none}.text .meta time{display:none}.text .body p:first-of-type{margin-top:0}.text pre{padding:0;font-size:inherit;line-height:1.5rem;overflow:hidden;white-space:pre-wrap;word-break:break-all}}.text .podcasts{margin-top:1.5rem;text-align:center}.text a.podcast{display:block;height:3rem}.text a.podcast img{width:50%;max-width:200px}@media screen and (min-width:768px){.text .podcasts{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));grid-gap:1.5rem}.text a.podcast img{width:100%}}.text .tombstone{opacity:0}.paginator{margin-top:1.5rem;text-align:center}.paginator a{display:inline-block;text-decoration:none;border-radius:3px;color:#2a2d34;border:1px solid #2a2d34;transition:.2s background-color ease-in-out,.2s color ease-in-out,.2s border-color ease-in-out;height:1rem;width:1rem;line-height:1rem;font-size:.7rem;margin-left:.2rem;margin-right:.2rem}.paginator a:hover,.paginator a.active{background:#004966;color:#fefefe;border:1px solid #004966}@media screen and (min-width:768px){.paginator a{height:1.5rem;width:1.5rem;line-height:1.5rem;font-size:1rem}}@media screen and (min-width:900px){.paginator a{height:3rem;width:3rem;line-height:3rem;font-size:1.2rem}}html,body{font-family:Arial,sans-serif;scroll-behavior:smooth;text-rendering:optimizeSpeed;-webkit-font-smoothing:antialiased;line-height:1.5rem;font-feature-settings:"liga" 1;font-weight:500;font-size:18px}@media(min-width:900px){html,body{font-size:20px}}@media(min-width:1100px){html,body{font-size:22px}}@media(min-width:1800px){html,body{font-size:24px}}@media print{html,body{font-size:18px}}hr{border:0;height:2px;background-color:#fe7f2d;margin-top:1.5rem;margin-bottom:1.5rem}.text{position:relative}.text .meta{font-variant:small-caps}.text .meta .byline{display:none}.text .meta .line{display:inline-block}.text .meta .calendar{display:none}.text h1,.text h2,.text h3,.text h4,.text h5,.text h6{font-family:Georgia,palatino linotype,book antiqua,Palatino,times new roman,serif;font-weight:500;page-break-after:avoid}.text h1 a,.text h1 a:visited,.text h2 a,.text h2 a:visited,.text h3 a,.text h3 a:visited,.text h4 a,.text h4 a:visited,.text h5 a,.text h5 a:visited,.text h6 a,.text h6 a:visited{color:#2a2d34;text-decoration:none}.text p,.text ul,.text ol,.text figure,.text dl,.text hr{margin-top:1.5rem;font-size:1rem}.text q{font-style:italic}.text ul ul{margin-top:0}.text p>code,.text ul>code,.text ol>code,.text dt>code,.text dd>code,.text li>code{color:#009b72}.text button{cursor:pointer;display:inline-block;box-sizing:border-box;border:.1rem solid #6761a8;height:1.5rem;padding-left:.75rem;padding-right:.75rem;border-radius:.2rem;transition:color .233s ease-in-out,background-color .233s ease-in-out}.text button:hover{color:#fff;background-color:#6761a8}.text audio{display:block;width:100%;height:1.5rem;outline:none}.text audio span{line-height:1.5rem}.text dl{overflow:auto;position:relative}.text dt{font-weight:700}.text dd{padding-left:2rem}.text dd+dt{margin-top:1.5rem}.text ul{list-style-type:disc;padding-left:1.5rem}.text ol{list-style-type:decimal;padding-left:1.5rem}.text p{overflow-wrap:break-word;word-wrap:break-word;-webkit-hyphens:auto;-moz-hyphens:auto;-ms-hyphens:auto;hyphens:auto}.text h1{font-size:2.5rem;font-weight:500;line-height:3rem;margin-top:1.5rem;margin-bottom:0}@media screen and (min-width:760px){.text h1{font-size:3.5rem;line-height:4.5rem;margin-top:1.5rem}}@media screen and (min-width:900px){.text h1{font-size:4rem;line-height:4.5rem;margin-top:3rem}}@media screen and (min-width:1400px){.text h1{font-size:5rem;line-height:6rem;margin-top:6rem}}.text h2{font-size:2rem;line-height:3rem;margin-top:3rem;margin-bottom:3rem}.text h3{font-size:1.5rem;line-height:1.5rem;margin-top:1.5rem;margin-bottom:1.5rem}.text h4{font-size:1rem;line-height:1.5rem;margin-top:1.5rem;margin-bottom:1.5rem}.text h5{font-size:.8rem;line-height:1.5rem;margin-top:1.5rem;margin-bottom:1.5rem}.text h6{font-size:.6rem;line-height:1.5rem;margin-top:1.5rem;margin-bottom:1.5rem}.text strong{font-weight:700}.text em{font-style:italic}.text blockquote{border-left:.2rem solid #999;padding-left:.75rem}.text code{font-family:lucida console,Monaco,monospace;speak:literal-punctuation}.text abbr,.text acronym{speak:spell-out}.text del{text-decoration:line-through}.text ins{text-decoration:none;font-style:italic}.text figure{position:relative;text-align:center}.text figure img{background:#fff;border-radius:.2rem;max-width:100%}.text figure table{min-width:75%;border-radius:.2rem;margin-left:auto;margin-right:auto;border:#6761a8;border-collapse:separate;border-spacing:0;background:#fff;margin-bottom:-.1em}.text figure table th,.text figure table td{padding-left:.75rem;padding-right:.75rem;line-height:1.3rem;border-left:.1rem solid #6761a8;border-top:.1rem solid #6761a8}.text figure table thead{background-color:#fff}.text figure table tr td:last-child,.text figure table tr th:last-child{border-right:.1rem solid #6761a8}.text figure table tbody:last-child tr:last-child td{border-bottom:.1rem solid #6761a8}.text figure table thead:first-child tr:first-child th:first-child,.text figure table thead:first-child tr:first-child td:first-child{border-top-left-radius:.2rem}.text figure table thead:first-child tr:first-child,.text figure table thead:first-child tr:first-child th:last-child,.text figure table thead:first-child tr:first-child td:last-child{border-top-right-radius:.2rem}.text figure table tbody:last-child tr:last-child,.text figure table tbody:last-child tr:last-child td:first-child{border-bottom-left-radius:.2rem}.text figure table tbody:last-child tr:last-child,.text figure table tbody:last-child tr:last-child td:last-child{border-bottom-right-radius:.2rem}.text figure ul{text-align:left}.text figure ul.tree{padding-top:1.5em;padding-bottom:1.5em;border-radius:.2rem;background:#fff}.text figure ul.tree li{list-style-type:none}.text figure ul.tree .tree__item--folder::before{content:"üìÅ";margin-right:.2em}.text figure ul.tree .tree__item--file::before{content:"üìù";margin-right:.2em}.text figure figcaption{font-style:italic}.text pre{margin-top:1.5rem;font-size:inherit;line-height:1.5rem;padding:1.5rem 1.5rem .75rem;white-space:pre;overflow-x:scroll;overflow-y:hidden;scrollbar-color:#cccccc transparent;scrollbar-width:.75rem}.text pre::-webkit-scrollbar{margin-top:-.75rem;height:.75rem}.text pre::-webkit-scrollbar-track{background:0 0}.text pre::-webkit-scrollbar-thumb{height:.1rem;border-radius:.2rem;background:#ccc}.text hr{border:0;height:.2rem;background:#6761a8;margin-top:1.3rem}.text .admonition{position:relative}.text .admonition>*{padding-left:2rem}.text .admonition>:first-child::before{display:block;text-align:left;position:absolute;top:0;left:0;width:.75rem;font-size:1rem;line-height:1.5rem;height:1.5rem}.text .admonition--tip>:first-child::before{content:"‚òõ";color:#00a000;font-size:1.5rem;line-height:1.5rem;height:1.5rem}.text .admonition--warning>:first-child::before{content:"‚ö†Ô∏è";color:#fe7f2d}.text .admonition--info>:first-child::before{content:"‚ìò";color:#004966;font-weight:700}@media print{.text h1{margin-left:auto;margin-right:auto;margin-top:9rem;width:80%;font-variant:small-caps;text-align:center}.text--simple h1{margin-top:0}.text .meta{page-break-after:always;text-align:center;font-size:1.2rem;margin-top:1.5rem}.text .meta a{text-decoration:none}.text .meta time{display:none}.text .body p:first-of-type{margin-top:0}.text pre{padding:0;font-size:inherit;line-height:1.5rem;overflow:hidden;white-space:pre-wrap;word-break:break-all}}.text .podcasts{margin-top:1.5rem;text-align:center}.text a.podcast{display:block;height:3rem}.text a.podcast img{width:50%;max-width:200px}@media screen and (min-width:768px){.text .podcasts{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));grid-gap:1.5rem}.text a.podcast img{width:100%}}.text .tombstone{opacity:0}</style><meta name=color-scheme content="dark light"></head><body><header><div class=page-header><div class=logo><a href=/><img src="data:image/svg+xml,%3Csvg baseProfile=%22tiny%22 id=%22Capa_1%22 xmlns=%22http://www.w3.org/2000/svg%22 xmlns:xlink=%22http://www.w3.org/1999/xlink%22 viewBox=%220 0 650 210%22%3E%3Cg%3E%3Cg%3E%3Ccircle fill=%22%23fff%22 cx=%22100.91%22 cy=%22104.98%22 r=%2268.91%22/%3E%3Cg%3E%3Cpath fill=%22%23bf181a%22 d=%22M100.91 36.12C62.85 36.12 32 66.97 32 105.03c0 23.47 11.74 44.18 29.66 56.63v-56.63c0-21.68 17.57-39.25 39.25-39.25s39.25 17.57 39.25 39.25-17.57 39.25-39.25 39.25c-8.76.0-16.82-2.91-23.35-7.76v33.35c7.29 2.63 15.15 4.07 23.35 4.07 38.06.0 68.91-30.85 68.91-68.91s-30.86-68.91-68.91-68.91z%22/%3E%3Ccircle fill=%22%23efc700%22 cx=%22100.91%22 cy=%22105.03%22 r=%2222.96%22/%3E%3Cpath fill=%22%23e6b600%22 d=%22M100.91 84.32c12.3.0 22.31 9.68 22.9 21.83.02-.38.06-.75.06-1.13.0-12.68-10.28-22.96-22.96-22.96s-22.96 10.28-22.96 22.96c0 .38.04.75.06 1.13C78.6 94 88.61 84.32 100.91 84.32z%22/%3E%3C/g%3E%3C/g%3E%3Cpath fill=%22%233c3c3c%22 d=%22M213.3 128.11V81.98h19.29c10.51.0 17.3 6.16 17.3 15.7.0 9.39-7.11 15.95-17.3 15.95h-9.02v14.47H213.3zm18.71-23.13c4.84.0 7.61-2.66 7.61-7.29.0-4.54-2.7-7.04-7.61-7.04h-8.45v14.33H232.01z%22/%3E%3Cpolygon fill=%22%233c3c3c%22 points=%22272.12,128.11 272.12,81.98 304.8,81.98 304.8,90.71 282.39,90.71 282.39,100.36 302.88,100.36 302.88,109.15 282.39,109.15 282.39,119.38 304.87,119.38 304.87,128.11%22/%3E%3Cpath fill=%22%233c3c3c%22 d=%22M354.71 128.11l-8.2-14.35h-8.39v14.35h-10.26V81.98h20.89c10.24.0 16.85 6.24 16.85 15.89.0 6.29-3.19 11.52-8.56 14.12l9.56 16.11H354.71zM347.66 105.23c4.81.0 7.68-2.77 7.68-7.42.0-4.59-2.8-7.23-7.68-7.23h-9.53v14.65H347.66z%22/%3E%3Cpath fill=%22%233c3c3c%22 d=%22M470.47 129.01c-12.53.0-20.63-8.12-20.63-20.69v-6.53c0-12.57 8.1-20.69 20.63-20.69 12.72.0 20.63 7.93 20.63 20.69v6.53C491.1 121.08 483.19 129.01 470.47 129.01zm0-39.2c-6.59.0-10.37 4.2-10.37 11.52v7.43c0 7.32 3.78 11.52 10.37 11.52 6.59.0 10.36-4.2 10.36-11.52v-7.43C480.83 94.01 477.06 89.81 470.47 89.81z%22/%3E%3Cpolygon fill=%22%233c3c3c%22 points=%22543.01,128.11 524.48,99.79 524.48,128.11 514.41,128.11 514.41,81.98 523.93,81.98 542.46,110.3 542.46,81.98 552.53,81.98 552.53,128.11%22/%3E%3Cpath fill=%22%233c3c3c%22 d=%22M607.7 128.11l-3.01-9.41h-16.47l-3.01 9.41h-10.29l16.54-46.13h10.01L618 128.11H607.7zM601.98 110.29l-5.52-17.45-5.58 17.45h11.1z%22/%3E%3Cg%3E%3Cpath fill=%22%233c3c3c%22 d=%22M418.62 111.85c-.77 5.33-4.37 8.5-9.73 8.5-8.74.0-10.05-7.3-10.05-11.65v-7.3c0-4.35 1.31-11.65 10.05-11.65 5.35.0 8.95 3.15 9.73 8.45l9.52-1.42c-1.28-9.33-8.95-15.7-19.24-15.7-12.68.0-20.24 7.76-20.24 20.76v6.4c0 13 7.57 20.76 20.24 20.76 10.3.0 17.98-6.39 19.25-15.74L418.62 111.85z%22/%3E%3C/g%3E%3C/g%3E%3C/svg%3E" alt=Percona></a></div><input type=checkbox id=show-mobile-menu value=1 aria-hidden=true><div class=mobile-toggle aria-controls=mobile-menu aria-label="Open navigation" role=button><label for=show-mobile-menu id=hamburger><span class=hamburger-bar></span><span class=hamburger-bar></span><span class=hamburger-bar></span></label></div><div class=mobile-menu id=mobile-menu aria-labelledby=navigation-header role=dialog aria-modal=false aria-hidden=true><nav><ul><li><a href=/blog><span>Blog</span></a></li><li><a href=/resources><span>Resources</span></a></li><li><a href=/projects><span>Projects</span></a></li><li><a href=/contribute><span>Contribute</span></a></li></ul></nav></div></div></header><main class=page><div class=page-main><article class=text itemscope itemtype=https://schema.org/BlogPosting><meta itemprop=image content="https://percona.community/blog/2020/07/image6.png"><meta itemprop=mainEntityOfPage content="https://percona.community/blog/2020-07-24-iiot-platform-databases-how-mail-ru-cloud-solutions-deals-with-petabytes-of-data-coming-from-a-multitude-of-devices/"><meta itemprop=keywords content="author_sergev, Advanced Level, Cache, ClickHouse, DevOps, IoT, Kubernetes, Kubernetes, Lua, NoSQL, Open Source Databases, SQL, Tarantool, Tools"><h1 itemprop="name headline">IIoT platform databases - How Mail.ru Cloud Solutions deals with petabytes of data coming from a multitude of devices</h1><div class=meta><time datetime="2020-07-24 14:11:14 +0000 UTC" itemprop=datePublished><span class=line>July 24, 2020</span>
<span class=calendar><span class=day>24</span>
<span class=month-year>Jul 2020</span></span></time>
<span class=authors>by <a href=/authors/andrey_sergeev/>Andrey Sergeev</a></span></div><div itemprop=articleBody class=body><p><figure><img sizes=100vw srcset="/blog/2020/07/image6_hu9a570a9ab6fb45fd89d79d40033f7e21_278260_480x0_resize_lanczos_2.png 480w, /blog/2020/07/image6_hu9a570a9ab6fb45fd89d79d40033f7e21_278260_768x0_resize_lanczos_2.png 768w, /blog/2020/07/image6_hu9a570a9ab6fb45fd89d79d40033f7e21_278260_1024x0_resize_lanczos_2.png 1024w" src=/blog/2020/07/image6.png alt="IIoT platform databases - How Mail.ru Cloud Solutions"></figure>Hello, my name is Andrey Sergeyev and I work as a Head of IoT Solution Development at <a href=https://mcs.mail.ru/ target=_blank rel="noopener noreferrer">Mail.ru Cloud Solutions</a>. We all know there is no such thing as a universal database. Especially when the task is to build an IoT platform that would be capable of processing millions of events from various sensors in near real-time.</p><p>Our product <a href=https://mcs.mail.ru/iot/ target=_blank rel="noopener noreferrer">Mail.ru IoT Platform</a> started as a Tarantool-based prototype. I‚Äôm going to tell you about our journey, the problems we faced and the solutions we found. I will also show you a current architecture for the modern Industrial Internet of Things platform. In this article we will look into:</p><ul><li>our requirements for the database, universal solutions, and the CAP theorem</li><li>whether the database + application server in one approach is a silver bullet</li><li>the evolution of the platform and the databases used in it</li><li>the number of Tarantools we use and how we came to this</li></ul><h2 id=mailru-iot-platform-today>Mail.ru IoT Platform today</h2><p>Our product Mail.ru IoT Platform is a scalable and hardware-independent platform for building Industrial Internet of Things solutions. It enables us to collect data from hundreds of thousands devices and process this stream in near real-time by using user-defined rules (scripts in Python and Lua) among other tools.</p><p>The platform can store an unlimited amount of raw data from the sources. It also has a set of ready-made components for data visualization and analysis as well as built-in tools for predictive analysis and platform-based app development.<figure><img sizes=100vw srcset="/blog/2020/07/image1_hufb7871c372c13b60ce4fb49d6523727e_88947_480x0_resize_lanczos_2.png 480w, /blog/2020/07/image1_hufb7871c372c13b60ce4fb49d6523727e_88947_768x0_resize_lanczos_2.png 768w, /blog/2020/07/image1_hufb7871c372c13b60ce4fb49d6523727e_88947_1024x0_resize_lanczos_2.png 1024w" src=/blog/2020/07/image1.png alt="Mail.ru IoT Platform set-up"></figure>Mail.ru IoT Platform set-up[/caption] The platform is currently available for on-premise installation on customers‚Äô facilities. In 2020 we are planning its release as a public cloud service.</p><h2 id=tarantool-based-prototype-how-we-started>Tarantool-based prototype: how we started</h2><p>Our platform started as a pilot project ‚Äì a prototype with a single instance Tarantool. Its primary functions were receiving a data stream from the OPC server, processing the events with Lua scripts in real-time, monitoring key indicators on its basis, and generating events and alerts for upstream systems.</p><p><figure><img sizes=100vw srcset="/blog/2020/07/image3_huc548728f6ee17ae3f4ff6f0dbb9a3b92_109577_480x0_resize_lanczos_2.png 480w, /blog/2020/07/image3_huc548728f6ee17ae3f4ff6f0dbb9a3b92_109577_768x0_resize_lanczos_2.png 768w, /blog/2020/07/image3_huc548728f6ee17ae3f4ff6f0dbb9a3b92_109577_1024x0_resize_lanczos_2.png 1024w" src=/blog/2020/07/image3.png alt="Flowchart of the Tarantool-based prototype"></figure></p><p>Flowchart of the Tarantool-based prototype[/caption] ¬† This prototype has even shown itself in the field conditions of a multi-well pad in Iraq. It worked at an oil platform in the Persian Gulf, monitoring key indicators and sending data to the visualization system and the event log. The pilot was deemed successful, but then, as it often happens with prototypes, it was put into cold storage until we got our hands on it.</p><h2 id=our-aims-in-developing-the-iot-platform>Our aims in developing the IoT platform</h2><p>Along with the prototype, we got ourselves a challenge of creating a fully functional, scalable, and failsafe IoT platform that could then be released as a public cloud service.</p><p>We had to build a platform with the following specifications:</p><ol><li>Simultaneous connection of hundreds of thousands of devices</li><li>Receiving millions of events every second</li><li>Datastream processing in near real-time</li><li>Storing several years of raw data</li><li>Analytics tools for both streaming and historic data</li><li>Support for deployment in multiple data centers to maximize disaster tolerance</li></ol><h2 id=pros-and-cons-of-the-platform-prototype>Pros and cons of the platform prototype</h2><p>At the start of active development the prototype had the following structure:</p><ul><li>Tarantool that was used as a database + Application Server</li><li>all the data was stored in Tarantool‚Äôs memory</li><li>this Tarantool had a Lua app that performed the data reception and processing and called the user scripts with incoming data</li></ul><p><strong>This type of app structure has its advantages:</strong></p><ol><li>The code and the data are stored in one place ‚Äì that enables to manipulate the data right in the application memory and get rid of extra network manipulations, which are typical for traditional apps</li><li>Tarantool uses the JIT (Just in Time Compiler) for Lua. It compiles Lua code into machine code, allowing simple Lua scripts to execute at the C-like speed (40,000 RPS per core and even higher!)</li><li>Tarantool is based upon cooperative multitasking. This means that every call of stored procedure runs in its own coroutine-like fiber. It gives a further performance boost for the tasks with I/O operations, e.g. network manipulations</li><li>Efficient use of resources: tools capable of handling 40,000 RPS per core are quite rare</li></ol><p><strong>There are also significant disadvantages:</strong></p><ol><li>We need storing several years of raw data from the devices, but we don‚Äôt have hundreds of petabytes for Tarantool</li><li>This item directly results from advantage #1. All of the platform code consists of procedures stored in the database, which means that any codebase update is basically a database update, and that sucks</li><li>Dynamic scaling gets difficult because the whole system‚Äôs performance depends on the memory it uses. Long story short, you can‚Äôt just add another Tarantool to increase the bandwidth capacity without losing 24 to 32 Gb of memory (while starting, Tarantool allocates all the memory for data) and resharding the existent data. Besides, when sharding, we lose the advantage #1 ‚Äì the data and the code may not be stored in the same Tarantool</li><li>Performance deteriorates as the code gets more complex with the platform progress. This happens not only because Tarantool executes all the Lua code in a single system stream, but also because the LuaJIT goes into interpreting mode instead of compiling when dealing with complex code</li></ol><p><strong>Conclusion:</strong> Tarantool is a good choice for creating an MVP, but it doesn‚Äôt work for a fully functional, easily maintained, and failsafe IoT platform capable of receiving, processing, and storing data from hundreds of thousands of devices.</p><h2 id=two-primary-problems-that-we-wanted-to-solve>Two primary problems that we wanted to solve</h2><p>First of all, there were two main issues we wanted to sort out:</p><ol><li>Ditching the concept of database + application server. We wanted to update the app code independently of the database.</li><li>Simplifying the dynamic scaling under stress. We wanted to have an easy independent horizontal scaling of the greatest possible number of functions</li></ol><p>To solve these problems, we took an innovative approach that was not well tested ‚Äì the microservice architecture divided into Stateless (the applications) and Stateful (the database).</p><p>In order to make maintenance and scaling the Stateless services out even simpler, we containerized them and adopted Kubernetes.</p><p><figure><img sizes=100vw srcset="/blog/2020/07/image9_huceeb5f8f8814a6ac79764e434ba1df4f_101212_480x0_resize_lanczos_2.png 480w, /blog/2020/07/image9_huceeb5f8f8814a6ac79764e434ba1df4f_101212_768x0_resize_lanczos_2.png 768w, /blog/2020/07/image9_huceeb5f8f8814a6ac79764e434ba1df4f_101212_1024x0_resize_lanczos_2.png 1024w" src=/blog/2020/07/image9.png alt=Kubernetes></figure></p><p>Now that we figured out the Stateless services, we have to decide what to do with the data.</p><h2 id=basic-requirements-for-the-iot-platform-database>Basic requirements for the IoT platform database</h2><p>At first, we tried not to overcomplicate things ‚Äì we wanted to store all the platform data in one single universal database. Having analyzed our goals, we came up with the following list of requirements for the universal database:</p><ol><li><strong>ACID transactions</strong> ‚Äì the clients will keep a register of their devices on the platform, so we wouldn‚Äôt want to lose some of them upon data modification</li><li><strong>Strict consistency</strong> ‚Äì we have to get the same responses from all of the database nodes</li><li><strong>Horizontal scaling for writing and reading</strong> ‚Äì the devices send a huge stream of data that has to be processed and saved in near real-time</li><li><strong>Fault tolerance</strong> ‚Äì the platform has to be capable of manipulating the data from multiple data centers to maximize fault tolerance</li><li><strong>Accessibility</strong> ‚Äì no one would use a cloud platform that shuts down whenever one of the nodes fails</li><li><strong>Storage volume and good compression</strong> ‚Äì we have to store several years (petabytes!) of raw data that also needs to be compressed.</li><li><strong>Performance</strong> ‚Äì quick access to raw data and tools for stream analytics, including access from the user scripts (tens of thousands of reading requests per second!)</li><li><strong>SQL</strong> ‚Äì we want to let our clients run analytics queries in a familiar language</li></ol><h2 id=checking-our-requirements-with-the-cap-theorem>Checking our requirements with the CAP theorem</h2><p>Before we started examining all the available databases to see if they meet our requirements, we decided to check whether our requirements are adequate by using a well-known tool ‚Äì the CAP theorem.</p><p>The CAP theorem states¬†that a distributed system cannot simultaneously have more than two of the following qualities:</p><ol><li><strong>Consistency</strong> ‚Äì data in all of the nodes have no contradictions at any point in time</li><li><strong>Availability</strong> ‚Äì any request to a distributed system results in a correct response, however, without a guarantee that the responses of all system nodes match</li><li><strong>Partition tolerance</strong> ‚Äì even when the nodes are not connected, they continue working independently</li></ol><p><figure><img sizes=100vw srcset="/blog/2020/07/image11_huabf36fca3432b8c2e6881dcc5c2206cd_35836_480x0_resize_lanczos_2.png 480w, /blog/2020/07/image11_huabf36fca3432b8c2e6881dcc5c2206cd_35836_768x0_resize_lanczos_2.png 768w, /blog/2020/07/image11_huabf36fca3432b8c2e6881dcc5c2206cd_35836_1024x0_resize_lanczos_2.png 1024w" src=/blog/2020/07/image11.png alt="Checking our requirements with the CAP theorem"></figure></p><p>For instance, the Master-Slave PostgreSQL cluster with synchronous replication is a classic example of a CA system and Cassandra is a classic AP system.</p><p>Let‚Äôs get back to our requirements and classify them with the CAP theorem:</p><ol><li>ACID transactions and strict (or at least not eventual) consistency are C.</li><li>Horizontal scaling for writing and reading + accessibility is A (multi-master).</li><li>Fault tolerance is P: if one data center shuts down, the system should stand.</li></ol><p><figure><img sizes=100vw srcset="/blog/2020/07/image10_huc552a83e60f7572d7abe9c68103d16f4_41029_480x0_resize_lanczos_2.png 480w, /blog/2020/07/image10_huc552a83e60f7572d7abe9c68103d16f4_41029_768x0_resize_lanczos_2.png 768w, /blog/2020/07/image10_huc552a83e60f7572d7abe9c68103d16f4_41029_1024x0_resize_lanczos_2.png 1024w" src=/blog/2020/07/image10.png alt=ACID></figure></p><p><strong>Conclusion:</strong> the universal database we require has to offer all of the CAP theorem qualities, which means that none of the existing databases can fulfill all of our needs.</p><h2 id=choosing-the-database-based-on-the-data-the-iot-platform-works-with>Choosing the database based on the data the IoT platform works with</h2><p>Being unable to pick a universal database, we decided to split the data into two types and choose a database for each type the database will work with.</p><p>With a first approximation we subdivided the data into two types:</p><ol><li><strong>Metadata</strong> ‚Äì the world model, the devices, the rules, the settings. Practically all the data except the data from the end devices</li><li><strong>Raw data from the devices</strong> ‚Äì sensor readings, telemetry, and technical information from the devices. These are time series of messages containing a value and a timestamp</li></ol><h3 id=choosing-the-database-for-the-metadata>Choosing the database for the metadata</h3><p><em>Our requirements</em></p><p>Metadata is inherently relational. It is typical for this data to have a small amount and be rarely modified, but the metadata is quite important. We can‚Äôt lose it, so consistency is important ‚Äì at least in terms of asynchronous replication, as well as ACID transactions and horizontal read scaling.</p><p>This data is comparatively little in amount and it will be changed rather infrequently, so you can ditch horizontal read scaling, as well as the possible inaccessibility of the read database in case of failure. That is why, in the language of the CAP theorem, we need a CA system.</p><p><strong>What usually works.</strong> If we put a question like this, we would do with any classic relational database with asynchronous replication cluster support, e.g. PostgreSQL or MySQL.</p><p><strong>Our platform aspects.</strong> We also needed support for trees with specific requirements. The prototype had a feature taken from the systems of the RTDB class (real-time databases) ‚Äì modeling the world using a tag tree. They enable us to combine all the client devices in one tree structure, which makes managing and displaying a large number of devices much easier.</p><p><figure><img sizes=100vw srcset="/blog/2020/07/image4_hu3fa08b81938118f44651524edc7c5a63_23964_480x0_resize_lanczos_2.png 480w, /blog/2020/07/image4_hu3fa08b81938118f44651524edc7c5a63_23964_768x0_resize_lanczos_2.png 768w, /blog/2020/07/image4_hu3fa08b81938118f44651524edc7c5a63_23964_1024x0_resize_lanczos_2.png 1024w" src=/blog/2020/07/image4.png alt="This is how the device tree looks like"></figure></p><p>This is how the device tree looks like ¬†</p><p>This tree enables linking the end devices with the environment. For example, we can put devices physically located in the same room in one subtree, which facilitates the work with them in the future. This function is very convenient, besides, we wanted to work with RTDBs in the future, and this functionality is basically the industry standard there.</p><p>To have a full implementation of the tag trees, a potential database must meet the following requirements:</p><ol><li>Support for trees with arbitrary width and depth.</li><li>Modification of tree elements in ACID transactions.</li><li>High performance when traversing a tree.</li></ol><p>Classic relational databases can handle small trees quite well, but they don‚Äôt do as well with arbitrary trees.</p><p><strong>Possible solution.</strong> Using two databases: a graph one for the tree and the relational one for all the other metadata.</p><p>This approach has major disadvantages:</p><ol><li>To ensure consistency between two databases, you need to add an external transaction coordinator.</li><li>This design is difficult to maintain and not so reliable.</li><li>As a result, we get two databases instead of one, while the graph database is only required for supporting limited functionality.</li></ol><p><figure><img sizes=100vw srcset="/blog/2020/07/image7_hu08204d033d2e4ee6b9eac1ac78d250b2_75897_480x0_resize_lanczos_2.png 480w, /blog/2020/07/image7_hu08204d033d2e4ee6b9eac1ac78d250b2_75897_768x0_resize_lanczos_2.png 768w, /blog/2020/07/image7_hu08204d033d2e4ee6b9eac1ac78d250b2_75897_1024x0_resize_lanczos_2.png 1024w" src=/blog/2020/07/image7.png alt="A possible, but not a perfect solution with two databases"></figure>A possible, but not a perfect solution with two databases ¬†</p><p><strong>Our solution for storing metadata.</strong> We thought a little longer and remembered that this functionality was initially implemented in a Tarantool-based prototype and it turned out very well.</p><p>Before we continue, I would like to give an unorthodox definition of Tarantool: <em>Tarantool is not a database, but a set of primitives for building a database for your specific case.</em></p><p>Available primitives out of the box:</p><ul><li>Spaces ‚Äì an equivalent of tables for storing data in the databases.</li><li>Full-fledged ACID transactions.</li><li>Asynchronous replication using WAL logs.</li><li>A sharding tool that supports automatic resharding.</li><li>Ultrafast LuaJIT for stored procedures.</li><li>Large standard library.</li><li>LuaRocks package manager with even more packages.</li></ul><p>Our CA solution was a relational + graph Tarantool-based database. We assembled perfect metadata storage with Tarantool primitives:</p><ul><li>Spaces for storage.</li><li>ACID transactions ‚Äì already in place.</li><li>Asynchronous replication ‚Äì already in place.</li><li>Relations ‚Äì we built them upon stored procedures.</li><li>Trees ‚Äì built upon stored procedures too.</li></ul><p>Our cluster installation is classic for systems like these ‚Äì one Master for writing and several Slaves with asynchronous replications for reading scaling.</p><p>As a result, we have a fast scalable hybrid of relational and graph databases.</p><p>One Tarantool instance is able to process thousands of reading requests, including those with active tree traversals.</p><h3 id=choosing-the-database-for-storing-the-data-from-the-devices>Choosing the database for storing the data from the devices</h3><p><em>Our requirements</em></p><p>This type of data is characterized by frequent writing and a large amount of data: millions of devices, several years of storage, petabytes of both incoming messages, and stored data. Its high availability is very important since the sensor readings are important for the user-defined rules and our internal services.</p><p>It is important that the database offers horizontal scaling for reading and writing, availability, and fault tolerance, as well as ready-made analytical tools for working with this data array, preferably SQL-based. We can sacrifice consistency and ACID transactions, so in terms of the CAP theorem, we need an AP system.</p><p><strong>Additional requirements.</strong> We had a few additional requirements for the solution that would store the gigantic amounts of data:</p><ol><li>Time Series ‚Äì sensor data that we wanted to store in a specialized base.</li><li>Open-source ‚Äì the advantages of open source code are self-explanatory.</li><li>Free cluster ‚Äì a common problem among modern databases.</li><li>Good compression ‚Äì given the amount of data and its homogeneity, we wanted to compress the stored data efficiently.</li><li>Successful maintenance ‚Äì in order to minimize risks, we wanted to start with a database that someone was already actively exploiting at loads similar to ours.</li></ol><p><strong>Our solution.</strong> The only database suiting our requirements was ClickHouse ‚Äì a columnar time-series database with replication, multi-master, sharding, SQL support, and a free cluster. Moreover, Mail.ru has many years of successful experience in operating one of the largest ClickHouse clusters.</p><p>But ClickHouse, however good it may be, didn‚Äôt work for us.</p><h3 id=problems-with-the-database-for-device-data-and-their-solution>Problems with the database for device data and their solution</h3><p><strong>Problem with writing performance.</strong> We immediately had a problem with the large data stream writing performance. It needs to be delivered to the analytical database as soon as possible so that the rules analyzing the flow of events in real-time can look at the history of a particular device and decide whether to raise an alert or not.</p><p><strong>Solution.</strong> ClickHouse is not good with multiple single inserts, but works well with large packets of data, easily coping with writing millions of lines in batches. We decided to buffer the incoming data stream, and then paste this data in batches.</p><p><figure><img sizes=100vw srcset="/blog/2020/07/image5_hud9d8da977cfe6822a4f7c6844c886a21_34130_480x0_resize_lanczos_2.png 480w, /blog/2020/07/image5_hud9d8da977cfe6822a4f7c6844c886a21_34130_768x0_resize_lanczos_2.png 768w, /blog/2020/07/image5_hud9d8da977cfe6822a4f7c6844c886a21_34130_1024x0_resize_lanczos_2.png 1024w" src=/blog/2020/07/image5.png alt="This is how we dealt with poor writing performance"></figure></p><p>This is how we dealt with poor writing performance ¬†</p><p>The writing problems were solved, but it cost us several seconds of lag between the data coming into the system and its appearance in our database.</p><p>This is critical for various algorithms that react to the sensor readings in real-time.</p><p><strong>Problem with reading performance.</strong> Stream analytics for real-time data processing constantly needs information from the database ‚Äì tens of thousands of small queries. On average, one ClickHouse node handles about a hundred analytical queries at any time. It was created to infrequently process heavy analytical queries with large amounts of data. Of course, this is not suitable for calculating trends in the data stream from hundreds of thousands of sensors.</p><p><figure><img sizes=100vw srcset="/blog/2020/07/image2_hub676d973825b72686aaa50d673ec660c_82621_480x0_resize_lanczos_2.png 480w, /blog/2020/07/image2_hub676d973825b72686aaa50d673ec660c_82621_768x0_resize_lanczos_2.png 768w, /blog/2020/07/image2_hub676d973825b72686aaa50d673ec660c_82621_1024x0_resize_lanczos_2.png 1024w" src=/blog/2020/07/image2.png alt="ClickHouse doesn‚Äôt handle a large number of queries well"></figure></p><p>ClickHouse doesn‚Äôt handle a large number of queries well</p><p><strong>Solution.</strong> We decided to place a cache in front of Clickhouse. The cache was meant to store the hot data that has been requested in the last 24 hours most often.</p><p>24 hours of data is not a year but still quite a lot ‚Äì so we need an AP system with horizontal scaling for reading and writing and a focus on performance while writing single events and numerous readings.</p><p>We also need high availability, analytic tools for time series, persistence, and built-in TTL. So, we needed a fast ClickHouse that could store everything in memory. Being unable to find any suitable solutions, we decided to build one based on the Tarantool primitives:</p><ol><li>Persistence ‚Äì check (WAL-logs + snapshots).</li><li>Performance ‚Äì check; all the data is in the memory.</li><li>Scaling ‚Äì check; replication + sharding.</li><li>High availability ‚Äì check.</li><li>Analytics tools for time series (grouping, aggregation, etc.) ‚Äì we built them upon stored procedures.</li><li>TTL ‚Äì built upon stored procedures with one background fiber (coroutine).</li></ol><p>The solution turned out to be powerful and easy to use. One instance handled 10,000 reading RPCs, including analytic ones.</p><p>Here is the architecture we came up with:</p><p><figure><img sizes=100vw srcset="/blog/2020/07/image8_hub56afe5f49227bf11743c3329e8fce7b_49745_480x0_resize_lanczos_2.png 480w, /blog/2020/07/image8_hub56afe5f49227bf11743c3329e8fce7b_49745_768x0_resize_lanczos_2.png 768w, /blog/2020/07/image8_hub56afe5f49227bf11743c3329e8fce7b_49745_1024x0_resize_lanczos_2.png 1024w" src=/blog/2020/07/image8.png alt="Final architecture: ClickHouse as the analytic database and the Tarantool cache storing 24 hours of data. "></figure></p><p>Final architecture: ClickHouse as the analytic database and the Tarantool cache storing 24 hours of data. ¬†</p><h2 id=a-new-type-of-data--the-state-and-its-storing>A new type of data ‚Äì the state and it‚Äôs storing</h2><p>We found a specific database for each type of data, but as the platform developed, another one appeared ‚Äì the status. The status consists of current statuses of sensors and devices, as well as some global variables for stream analytics rules.</p><p>Let‚Äôs say we have a lightbulb. The light may be either on or off, and we always need to have access to its current state, including one in the rules. Another example is a variable in stream rules ‚Äì e.g., a counter of some sort.</p><p>This type of data needs frequent writing and fast access but doesn‚Äôt take a lot of space.</p><p>Metadata storage doesn‚Äôt suit this type of data well, because the status may change quite often and we only have one Master for writing. Durable and operating storage doesn‚Äôt work well too, because our status was last changed three years ago, and we need to have quick reading access.</p><p>This means that the status database needs to have horizontal scaling for reading and writing, high availability, fault tolerance, and consistency on the values/documents level. We can sacrifice global consistency and ACID transactions.</p><p>Any Key-Value or a document database should work: Redis sharding cluster, MongoDB, or, once again, Tarantool.</p><p>Tarantool advantages:</p><ol><li>It is the most popular way of using Tarantool.</li><li>Horizontal scaling ‚Äì check; asynchronous replication + sharding.</li><li>Consistency on the document level ‚Äì check.</li></ol><p>As a result, we have three Tarantools that are used differently: one for storing metadata, a cache for quick reading from the devices, and one for storing status data.</p><h2 id=how-to-choose-a-database-for-your-iot-platform>How to choose a database for your IoT platform</h2><ol><li>There is no such thing as a universal database.</li><li>Each type of data should have its own database, the one most suitable.</li><li>There is a chance you may not find a fitting database in the market.</li><li>Tarantool can work as a basis for a specialized database</li></ol></div></article></div></main><footer class=page><h1 class=aria-only id=footer-heading aria-hidden=false>Footer</h1><div class=page-footer><nav class=footer><ul><li><a href=https://www.percona.com/about-percona target=_blank rel="noopener noreferrer"><span>About</span></a></li><li><a href=https://www.percona.com/legal target=_blank rel="noopener noreferrer"><span>Legal</span></a></li><li><a href=https://forums.percona.com/ target=_blank rel="noopener noreferrer"><span>Forums</span></a></li><li><a href=https://www.percona.com/about-percona/contact target=_blank rel="noopener noreferrer"><span>Contact</span></a></li></ul></nav></div><aside>¬© Percona Community. MySQL, InnoDB, MariaDB and MongoDB are trademarks of their respective owners.</aside></footer><script type=text/javascript src=https://percona.community/js/aria.5f30892348d4662fe548bb410f15fc6fe2e1cbfd6473beb3c3ed1d6b362568bbea48896a9f2302a4f78f4614904ca3ef43155ae26f063ed84ae957f951e19647.js integrity="sha512-XzCJI0jUZi/lSLtBDxX8b+Lhy/1kc76zw+0dazYlaLvqSIlqnyMCpPePRhSQTKPvQxVa4m8GPthK6Vf5UeGWRw==" defer></script></body></html>